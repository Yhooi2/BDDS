# BDDS Dashboard

Финансовый дашборд для отображения бюджета движения денежных средств.

**Demo:** https://yhooi2.github.io/BDDS/

## Быстрый старт

### 1. Локальный запуск
```bash
# Откройте index.html в браузере
open index.html

# Или через локальный сервер
npx serve .
```

### 2. Загрузка данных из API

```javascript
// Формат данных API
const apiData = {
  data: {
    "ДВН": {
      "Факт '24": {
        "Поступления по операционной деятельности": 2200000,
        "Выплата дохода акционерам (пайщикам)": -920000,
        // ... остальные метрики
      },
      "План '26": { ... }
    },
    "ЗОЛЯ": { ... }
  }
};

// Загрузка в дашборд
window.BDDS.Dashboard.loadData(apiData);
```

### 3. Загрузка с сервера

```javascript
fetch('/api/budget-data')
  .then(res => res.json())
  .then(data => window.BDDS.Dashboard.loadData(data));
```

## Формат данных API

```javascript
{
  "data": {
    "<Название фонда>": {
      "<Название периода>": {
        "<Название метрики>": <число или null>
      }
    }
  }
}
```

### Названия периодов
- `"Факт '23"` - факт за 2023 год
- `"Факт '24"` - факт за 2024 год
- `"План '26"` - план на 2026 год
- `"Факт (I-III кв. '25)\nПлан (IV кв. '25)"` - смешанный период

### Названия фондов
`ДВН`, `ЗОЛЯ`, `КРАС`, `ЛОГ`, `НОР`, `ОЗН`, `ТРМ`, `СБЛ`

### Названия метрик

**Операционная деятельность:**
- Движение Д/С по операционной деятельности ООО
- Поступления по операционной деятельности
- Расходы по основной деятельности
- Обеспечительные платежи

**Инвестиционная деятельность:**
- Движение Д/С по инвестиционной деятельности
- Выплата дохода акционерам (пайщикам)
- Расходы на капитальный ремонт

**Финансовая деятельность:**
- Движение Д/С по финансовой деятельности
- Расчеты по кредитам
- Прочие доходы и расходы по финансовой деятельности
- Расходы на УК Парус

**Остатки и резервы:**
- Остаток по кредиту на начало периода
- Остаток по кредиту на конец периода
- Движение за период по Д/С
- Сформированные резервы (нарастающим итогом)
- Накопленные резервы на ремонт, непредвиденные расходы и вакансию
- Остаток Д/С на начало периода
- Остаток Д/С на конец периода
- Д/С на конец периода (с учетом резерва)

### Пример полных данных

```javascript
{
  "data": {
    "ДВН": {
      "Факт '24": {
        "Движение Д/С по операционной деятельности ООО": 1650000,
        "Поступления по операционной деятельности": 2200000,
        "Расходы по основной деятельности": 1900000,
        "Обеспечительные платежи": 120000,
        "Движение Д/С по инвестиционной деятельности": 550000,
        "Выплата дохода акционерам (пайщикам)": -920000,
        "Расходы на капитальный ремонт": 180000,
        "Движение Д/С по финансовой деятельности": 350000,
        "Расчеты по кредитам": 220000,
        "Прочие доходы и расходы по финансовой деятельности": 60000,
        "Расходы на УК Парус": 130000,
        "Остаток по кредиту на начало периода": 4800000,
        "Остаток по кредиту на конец периода": 4500000,
        "Движение за период по Д/С": 300000,
        "Сформированные резервы (нарастающим итогом)": 350000,
        "Накопленные резервы на ремонт, непредвиденные расходы и вакансию": 320000,
        "Остаток Д/С на начало периода": 1250000,
        "Остаток Д/С на конец периода": 1550000,
        "Д/С на конец периода (с учетом резерва)": 1870000
      }
    }
  }
}
```

## Тестирование

Откройте `test-api.html` для проверки загрузки данных.

### Тестирование в консоли браузера

```javascript
// 1. Проверить, что функции доступны
console.log(DataModule.transformRawApiData);
console.log(BDDS.Dashboard);

// 2. Загрузить тестовые данные
BDDS.Dashboard.state.rawApiData = {
  data: {
    "ДВН": {
      "Факт '23": {
        "Движение Д/С по операционной деятельности ООО": 999999,
        "Выплата дохода акционерам (пайщикам)": -111111
      },
      "План '26": {
        "Движение Д/С по операционной деятельности ООО": 888888,
        "Выплата дохода акционерам (пайщикам)": -222222
      }
    }
  }
};

// 3. Перегенерировать и перерисовать
BDDS.Dashboard.generateData();
BDDS.Dashboard.render();

// 4. Проверить преобразованные данные
console.log(BDDS.Dashboard.state.periodData);
```

Если в таблице появились числа `999 999` — данные загружены успешно.

### Как Dashboard получает данные

```
1. Dashboard.init()
   └─→ Dashboard.generateData()
       ├─→ Если есть state.rawApiData:
       │   └─→ transformRawApiData(rawApiData, currentFund)
       │       └─→ Преобразует { data: { fund: { period: metrics } } }
       │           в [{ id, title, type, year, metrics }]
       └─→ Иначе (демо-режим):
           └─→ generatePeriodData(periods, multiplier)
               └─→ Генерирует тестовые данные из BASE_VALUES

2. Dashboard.render()
   └─→ Использует state.periodData для отрисовки таблиц
```

### Функции преобразования данных

| Функция | Входной формат | Использование |
|---------|----------------|---------------|
| `transformRawApiData(data, fund)` | `{ data: { fund: { period: {...} } } }` | Данные с API |
| `transformRawData(data)` | `[{ period: "...", metric: value }]` | Простой массив |
| `generatePeriodData(periods, mult)` | Конфигурация периодов | Демо-данные |

## API Dashboard

```javascript
// Загрузить данные из API
window.BDDS.Dashboard.loadData(apiData);

// Получить текущее состояние
window.BDDS.Dashboard.getState();

// Обновить конфигурацию
window.BDDS.Dashboard.updateData({
  currentFund: "ЗОЛЯ",
  chartConfig: { customValues: [400, 700, 900, 1000] }
});
```

## Генерация тестовых данных

Если API данные не загружены, дашборд использует сгенерированные тестовые данные.

```javascript
// Доступно в консоли браузера
const data = generatePeriodData(DEFAULT_PERIODS, 1.0);
console.log(data);

// С множителем фонда
const krasData = generatePeriodData(DEFAULT_PERIODS, getFundMultiplier('КРАС'));
```

## Структура проекта

```
BDDS/
├── index.html       # Главная страница дашборда
├── styles.css       # Стили
├── script.js        # Логика UI и компоненты
├── generateData.js  # Генерация и трансформация данных
├── test-api.html    # Тестовая страница для API
└── README.md        # Документация
```
